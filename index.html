<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CKPool Swarm ALPHA Board</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<!-- fallback full-page refresh every 5 s -->
<meta http-equiv="refresh" content="5" />

<style>
/* ===== minimalist dark theme ===== */
html,body{margin:0;height:100%;background:#000;color:#fff;
          font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif}
*{box-sizing:border-box}

/* ===== matrix canvas (full-screen, behind everything) ===== */
#matrix{position:fixed;inset:0;z-index:0;background:#000;pointer-events:none}

/* ===== layout ===== */
.wrapper{position:relative;z-index:1;   /* keep stats above canvas */
         display:flex;flex-direction:column;justify-content:center;
         align-items:center;gap:2rem;height:100%}

/* clock + title */
#datetime{font-size:1.5rem;font-weight:600;text-align:center}
#title  {font-size:2.5rem;font-weight:800;letter-spacing:2px;
         text-align:center;margin-top:-1rem}

/* worker list */
#workers{display:flex;flex-direction:column;gap:1.2rem;width:90%;max-width:900px}

/* each row */
.row{display:flex;align-items:center;justify-content:space-between;
     font-size:1.8rem;font-weight:700;letter-spacing:.5px}

/* columns */
.icon{width:2.5rem;text-align:center}
.name{text-align:left;flex:1}
.hash{width:9rem;text-align:center}   /* centered now */
.best{width:9rem;text-align:right}

/* responsive */
@media(max-width:600px){
  .row{font-size:1.3rem}
  .hash,.best{width:7rem}
  #title{font-size:1.8rem}
}
</style>
</head>

<body>
<canvas id="matrix"></canvas>

<div class="wrapper">
    <div id="datetime">Loading time…</div>
    <div id="title">Swarm&nbsp;ALPHA</div>
    <div id="workers">Fetching CKPool data…</div>
</div>

<script>
/* ===== CONFIG ===== */
const ADDRESS  = 'bc1qjstetm3fsjnc0d9xuwqv3wlucm9slcm9l9gqxa';
const CK_URL   = `https://solo.ckpool.org/users/${ADDRESS}`;
const PROXY    = 'https://corsproxy.io/?';   // swap if rate-limited
const FETCH_URL = PROXY + encodeURIComponent(CK_URL);

/* ===== UTILS ===== */
function toNumber(str='0'){
  let num=parseFloat(str);
  if(str.includes('P'))num*=1e15;
  else if(str.includes('T'))num*=1e12;
  else if(str.includes('G'))num*=1e9;
  else if(str.includes('M'))num*=1e6;
  else if(str.includes('K'))num*=1e3;
  return num;
}

/* ===== CLOCK ===== */
function tickClock(){
  const now=new Date();
  document.getElementById('datetime').textContent=
    now.toLocaleString(undefined,{
      weekday:'short',year:'numeric',month:'long',day:'numeric',
      hour:'2-digit',minute:'2-digit',second:'2-digit'
    });
}
tickClock();setInterval(tickClock,1000);

/* ===== FETCH + RENDER WORKERS ===== */
async function refreshStats(){
  try{
    const res=await fetch(FETCH_URL);
    if(!res.ok)throw new Error(res.statusText);
    const data=await res.json?await res.json():JSON.parse(await res.text());
    const workers=data.worker??[];

    /* sort by bestever descending */
    workers.sort((a,b)=>b.bestever-a.bestever);

    const container=document.getElementById('workers');
    container.innerHTML='';
    workers.forEach(w=>{
      const id=w.workername.split('.')[1]??w.workername;
      const hashrate=w.hashrate1m;
      const bestever=w.bestever.toLocaleString();
      const active=toNumber(hashrate)>0;
      const icon=active?'🟢':'🔴';

      const row=document.createElement('div');
      row.className='row';
      row.innerHTML=`
        <span class="icon">${icon}</span>
        <span class="name">${id}</span>
        <span class="hash">${hashrate}</span>
        <span class="best">${bestever}</span>`;
      container.appendChild(row);
    });
  }catch(e){
    console.error(e);
    document.getElementById('workers').textContent='Failed to load CKPool data.';
  }
}
refreshStats();setInterval(refreshStats,5000);

/* ===== MATRIX RAIN CANVAS ===== */
const canvas=document.getElementById('matrix');
const ctx=canvas.getContext('2d');
let w,h,font=14,cols,drops,letters=
  'アァカサタナハマヤャラワガザダバパイィキシチニヒミリヰギジヂビピウゥクスツヌフムユュルグズヅブプエェケセテネヘメレヱゲゼデベペオォコソトノホモヨョロヲゴゾドボポ0123456789ABCDEF';

function resize(){
  w=canvas.width=window.innerWidth;
  h=canvas.height=window.innerHeight;
  cols=Math.floor(w/font);
  drops=Array(cols).fill(1);
}
resize();window.addEventListener('resize',resize);

function draw(){
  ctx.fillStyle='rgba(0,0,0,0.05)';ctx.fillRect(0,0,w,h);
  ctx.fillStyle='#0f0';ctx.font=font+'px monospace';
  drops.forEach((y,i)=>{
    const text=letters.charAt(Math.random()*letters.length|0);
    ctx.fillText(text,i*font,y*font);
    drops[i]=y*font>h&&Math.random()>0.975?0:y+1;
  });
}
setInterval(draw,33);
</script>
</body>
</html>
